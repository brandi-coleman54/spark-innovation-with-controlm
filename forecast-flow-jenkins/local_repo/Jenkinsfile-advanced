pipeline {
  agent any

  stages {
    stage('Validate CTM CLI') {
      steps {
        sh '''#!/usr/bin/env bash
            set -euo pipefail
            source /var/jenkins_home/venv/bin/activate 
            ctm -v
            '''
      }
    }

    
     stage('Build Workflow') {
      steps {
        sh '''#!/usr/bin/env bash
            set -euo pipefail
            source /var/jenkins_home/venv/bin/activate 
            ctm build /var/jenkins_home/workflows/forecast-flow-jenkins/workflows/forecast-flow.json
            '''
      }
    }

    stage('Deploy Workflow') {
      steps {
        sh '''#!/usr/bin/env bash
            set -euo pipefail
            source /var/jenkins_home/venv/bin/activate 
            ctm deploy /var/jenkins_home/workflows/forecast-flow-jenkins/workflows/forecast-flow.json
            '''
      }
    }
    
  }
}
