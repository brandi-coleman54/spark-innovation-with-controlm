{
  "Defaults": {
    "Application": "zzz_telco_onboarding",
    "SubApplication": "zzz_new_customer",
    "ControlmServer": "IN01",
    "Host": "zzz_instruqt_server",
    "RunAs": "controlm"
  },
  "zzz_Telco_Onboarding_Workflow": {
    "Type": "Folder",
    "Variables": [
      { "customer_id": "98765" },
      { "activation_id": "54321" }
    ],
    "Description": "Automates end-to-end onboarding for a new mobile subscriber. Covers KYC, credit, SIM provisioning, billing setup, customer notification, and reporting.",
    "OrderMethod": "Manual",
    "Capture_Customer_Request": {
      "Type": "Job:Command",
      "Command": "python3 /home/controlm/spark-innovation-with-controlm/subscriber-onboarding/scripts/capture_customer.py --customer %%customer_id"
    },
    "Credit_And_Fraud_Check": {
      "Type": "Job:Command",
      "Command": "python3 /home/controlm/spark-innovation-with-controlm/subscriber-onboarding/scripts/credit_fraud_check.py --activation %%activation_id"
    },
    "Provision_SIM_And_Services": {
      "Type": "Job:Command",
      "Command": "python3 /home/controlm/spark-innovation-with-controlm/subscriber-onboarding/scripts/provision_sim.py --activation %%activation_id"
    },
    "Billing_Setup": {
      "Type": "Job:Command",
      "Command": "python3 /home/controlm/spark-innovation-with-controlm/subscriber-onboarding/scripts/setup_billing.py --activation %%activation_id"
    },
    "Notify_Customer": {
      "Type": "Job:Command",
      "Command": "python3 /home/controlm/spark-innovation-with-controlm/subscriber-onboarding/scripts/notify_customer.py --customer %%customer_id"
    },
    "Generate_Daily_Telco_Report": {
      "Type": "Job:Command",
      "Command": "python3 /home/controlm/spark-innovation-with-controlm/subscriber-onboarding/scripts/reporting.py --date $(date +%F)"
    }, 
    "SLA" : {
	 "Type" : "Job:SLAManagement",
	 "ServiceName" : "replace-with-usercode Subscriber Onboarding",
	 "JobRunsDeviationsTolerance" : "3",
	 "CompleteIn" : {
		 "Time" : "0:10"
		 },
		 "ServiceActions" : {
			 "If:SLA:ServiceIsLate_0" : {
			 "Type" : "If:SLA:ServiceIsLate",
			 "Action:SLA:Notify_0" : {
			"Type" : "Action:SLA:Mail",
       "Email" : "replace-with-email",
       "Subject" : "Service %%SERVICE_NAME is late",
        "Message" : "Service %%SERVICE_NAME is projected to be late. The service deadline is %%SERVICE_DUE_TIME but it is estimated to complete at %%SERVICE_EXPECTED_END_TIME. The following job(s) are problematic: %%PROBLEMATIC_JOBS"
          }
		}
	}}, 
  "Flow": {
	"Type": "Flow",
	"Sequence": ["Capture_Customer_Request", "Credit_And_Fraud_Check","Provision_SIM_And_Services","Billing_Setup","Notify_Customer","Generate_Daily_Telco_Report","SLA" ]
   }
  }
}
