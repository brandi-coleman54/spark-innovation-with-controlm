{
    "Defaults": {
        "Host": "zzz-eks-hg",
        "ControlmServer": "IN01",
        "Application": "zzz_whiskey_pipeline",
        "SubApplication": "zzz_process_whiskey_data",
        "RunAs": "controlm"
    },
    "zzz_whiskey_retail_shop": {
        "Type": "Folder",
        "OrderMethod": "Manual",
        "Variables": [
            {
                "usercode": "zzz"
            },
            {
                "td_email": "user@bmc.com"
            }
        ],
        "transfer_resources": {
            "Type": "Job:FileTransfer",
            "ConnectionProfileSrc": "ZZZ_SFTP",
            "ConnectionProfileDest": "SPARKIT_FS",
            "FileTransfers": [
                {
                    "Src": "/root/labs/whiskey-retail/scripts/*.py",
                    "Dest": "~/",
                    "TransferOption": "SrcToDest",
                    "TransferType": "Binary"
                },
                {
                    "Src": "/root/labs/whiskey-retail/scripts/analyze_data.sh",
                    "Dest": "~/",
                    "TransferOption": "SrcToDest",
                    "TransferType": "Binary"
                },
                {
                    "Src": "/root/labs/whiskey-retail/data/all-whiskey-clean.csv",
                    "Dest": "~/all-whiskey.csv",
                    "TransferOption": "SrcToDest",
                    "TransferType": "Binary"
                },
                {
                    "Src": "/root/labs/whiskey-retail/data/all_dates.csv",
                    "Dest": "~/all_dates.csv",
                    "TransferOption": "SrcToDest",
                    "TransferType": "Binary"
                }
            ]
        },
        "init_db": {
            "Type": "Job:Command",
            "FileName": "create_schema.py",
            "FilePath": "/home/controlm",
            "RunAs": "controlm",
            "Command": ". /home/controlm/venv/bin/activate && python ~/create_schema.py zzz"
        },
        "prep_db": {
            "Type": "Job:Command",
            "FileName": "complete_db_setup.py",
            "FilePath": "/home/controlm",
            "RunAs": "controlm",
            "Command": ". /home/controlm/venv/bin/activate && python ~/complete_db_setup.py zzz",
            "eventsToAdd": {
                "Type": "AddEvents",
                "Events": [
                    {
                        "Event": "prep_db-TO-payments_ref"
                    }
                ]
            }
        },
        "init_flow": {
            "Type": "Flow",
            "Sequence": [
                "transfer_resources",
                "init_db",
                "prep_db"
            ]
        },
        "get_product_data": {
            "Type": "Job:Command",
            "FileName": "get_product_data.py",
            "FilePath": "/home/controlm",
            "RunAs": "controlm",
            "Command": ". /home/controlm/venv/bin/activate && python ~/get_product_data.py zzz"
        },
        "insert_product_data": {
            "Type": "Job:Command",
            "RunAs": "controlm",
            "FileName": "insert_product_data.py",
            "FilePath": "/home/controlm",
            "Command": ". /home/controlm/venv/bin/activate && python ~/insert_product_data.py zzz"
        },
        "product_flow": {
            "Type": "Flow",
            "Sequence": [
                "prep_db",
                "get_product_data",
                "insert_product_data",
                "get_payment_data"
            ]
        },
        "insert_date_data": {
            "Type": "Job:Command",
            "RunAs": "controlm",
            "FileName": "insert_date_data.py",
            "FilePath": "/home/controlm",
            "Command": ". /home/controlm/venv/bin/activate && python ~/insert_date_data.py zzz"
        },
        "date_flow": {
            "Type": "Flow",
            "Sequence": [
                "prep_db",
                "insert_date_data",
                "get_payment_data"
            ]
        },
        "set_customer_data": {
            "Type": "Job:Command",
            "FileName": "set_customer_data.py",
            "FilePath": "/home/controlm",
            "RunAs": "controlm",
            "Command": ". /home/controlm/venv/bin/activate && python ~/set_customer_data.py zzz"
        },
        "normalize_customers": {
            "Type": "Job:Command",
            "FileName": "normalize_customers.py",
            "FilePath": "/home/controlm",
            "RunAs": "controlm",
            "Command": ". /home/controlm/venv/bin/activate && python ~/normalize_customers.py zzz"
        },
        "insert_countries": {
            "Type": "Job:Command",
            "FileName": "insert_countries_data.py",
            "FilePath": "/home/controlm",
            "RunAs": "controlm",
            "Command": ". /home/controlm/venv/bin/activate && python ~/insert_countries_data.py zzz"
        },
        "insert_customer_cc": {
            "Type": "Job:Command",
            "RunAs": "controlm",
            "FileName": "insert_customer_cc.py",
            "FilePath": "/home/controlm",
            "Command": ". /home/controlm/venv/bin/activate && python ~/insert_customer_cc.py zzz"
        },
        "insert_customer_data": {
            "Type": "Job:Command",
            "RunAs": "controlm",
            "FileName": "insert_customer_data.py",
            "FilePath": "/home/controlm",
            "Command": ". /home/controlm/venv/bin/activate && python ~/insert_customer_data.py zzz"
        },
        "customer_flow1": {
            "Type": "Flow",
            "Sequence": [
                "prep_db",
                "set_customer_data",
                "normalize_customers",
                "insert_countries",
                "insert_customer_data",
                "get_payment_data"
            ]
        },
        "customer_flow2": {
            "Type": "Flow",
            "Sequence": [
                "normalize_customers",
                "insert_customer_cc",
                "insert_customer_data"
            ]
        },
        "set_employee_data": {
            "Type": "Job:Command",
            "FileName": "set_employee_data.py",
            "FilePath": "/home/controlm",
            "RunAs": "controlm",
            "Command": ". /home/controlm/venv/bin/activate && python ~/set_employee_data.py zzz"
        },
        "normalize_employees": {
            "Type": "Job:Command",
            "FileName": "normalize_employees.py",
            "FilePath": "/home/controlm",
            "RunAs": "controlm",
            "Command": ". /home/controlm/venv/bin/activate && python ~/normalize_employees.py zzz"
        },
        "insert_department_data": {
            "Type": "Job:Command",
            "RunAs": "controlm",
            "FileName": "insert_department_data.py",
            "FilePath": "/home/controlm",
            "Command": ". /home/controlm/venv/bin/activate && python ~/insert_department_data.py zzz"
        },
        "insert_employee_data": {
            "Type": "Job:Command",
            "RunAs": "controlm",
            "FileName": "insert_employee_data.py",
            "FilePath": "/home/controlm",
            "Command": ". /home/controlm/venv/bin/activate && python ~/insert_employee_data.py zzz"
        },
        "employee_flow": {
            "Type": "Flow",
            "Sequence": [
                "prep_db",
                "set_employee_data",
                "normalize_employees",
                "insert_department_data",
                "insert_employee_data",
                "get_payment_data"
            ]
        },
        "get_payment_data": {
            "Type": "Job:Command",
            "FileName": "get_payment_data.py",
            "FilePath": "/home/controlm",
            "RunAs": "controlm",
            "Command": ". /home/controlm/venv/bin/activate && python ~/get_payment_data.py zzz"
        },
        "insert_payment_data": {
            "Type": "Job:Command",
            "FileName": "insert_payment_data.py",
            "FilePath": "/home/controlm",
            "RunAs": "controlm",
            "Command": ". /home/controlm/venv/bin/activate && python ~/insert_payment_data.py zzz"
        },
        "finalize_db": {
            "Type": "Job:Command",
            "FileName": "finalize_db.py",
            "FilePath": "/home/controlm",
            "RunAs": "controlm",
            "RunAsDummy": true,
            "Command": ". /home/controlm/venv/bin/activate && python ~/finalize_db.py zzz",
            "IfBase:Folder:CompletionStatus_0": {
                "Type": "If:CompletionStatus",
                "CompletionStatus": "NOTOK",
                "Action:SetToNotOK_0": {
                    "Type": "Action:SetToOK"
                }
            },
            "eventsToAdd": {
                "Type": "AddEvents",
                "Events": [
                    {
                        "Event": "finalize_db-TO-analysis"
                    }
                ]
            }
        },
        "finalize_flow": {
            "Type": "Flow",
            "Sequence": [
                "get_payment_data",
                "insert_payment_data",
                "finalize_db"
            ]
        },
        "analysis": {
            "Type": "Job:Command",
            "Host": "zzz-sts-0",
            "FileName": "analyze_data.sh",
            "FilePath": "/home/controlm",
            "RunAs": "controlm",
            "Command": ". ~/venv/bin/activate && chmod +x ~/analyze_data.sh && ~/analyze_data.sh zzz",
            "eventsToAdd": {
                "Type": "AddEvents",
                "Events": [
                    {
                        "Event": "analysis-TO-SLA"
                    }
                ]
            },
            "eventsToWaitFor": {
                "Type": "WaitForEvents",
                "Events": [
                    {
                        "Event": "finalize_db-TO-analysis"
                    }
                ]
            },
            "eventsToDelete": {
                "Type": "DeleteEvents",
                "Events": [
                    {
                        "Event": "finalize_db-TO-analysis"
                    }
                ]
            }
        },
        "SLA": {
            "Type": "Job:SLAManagement",
            "ServiceName": "ZZZ Product Data Pipeline",
            "ServicePriority": "1",
            "JobRunsDeviationsTolerance": "3",
            "eventsToWaitFor": {
                "Type": "WaitForEvents",
                "Events": [
                    {
                        "Event": "analysis-TO-SLA"
                    }
                ]
            },
            "eventsToDelete": {
                "Type": "DeleteEvents",
                "Events": [
                    {
                        "Event": "analysis-TO-SLA"
                    }
                ]
            }
        }
    }
}














