{
  
    "Defaults": {
        "Application": "zzz_data",
        "SubApplication": "zzz_flow",
        "ControlmServer": "IN01",
        "CreatedBy" : "rjacobs", 
        "OrderMethod" : "Manual",
        "Host": "zzz_instruqt_server",
        "RunAs": "controlm"
    },
  "zzz-AI-Fraud-Detection" : {
    "Type" : "Folder",

    "ActiveRetentionPolicy" : "CleanEndedOK",


    "Confirm" : true,
    "When" : {
      "RuleBasedCalendars" : {
        "Included" : [ "EVERYDAY" ],
        "EVERYDAY" : {
          "Type" : "Calendar:RuleBased",
          "When" : {
            "DaysRelation" : "OR",
            "WeekDays" : [ "NONE" ],
            "MonthDays" : [ "ALL" ]
          }
        }
      }
    },
    "zzz-AI-Fraud-Service" : {
      "Type" : "Job:SLAManagement",
      "ServiceName" : "zzz-AI-Fraud-Service-Monitor",

      "Host" : "ctmawsdemoqa.vse.bmc.com",
      "JobRunsDeviationsTolerance" : "3",

      "RunAs" : "controlm",
 
      "CompleteBy" : {
        "Time" : "12:00",
        "Days" : "0"
      },
      "When" : {
        "WeekDays" : [ "NONE" ],
        "MonthDays" : [ "ALL" ],
        "DaysRelation" : "OR"
      },
      "eventsToWaitFor" : {
        "Type" : "WaitForEvents",
        "Events" : [ {
          "Event" : "zzz-AI-Reporting-TO-zzz-AI-Fraud-Service"
        } ]
      },
      "eventsToDelete" : {
        "Type" : "DeleteEvents",
        "Events" : [ {
          "Event" : "zzz-AI-Reporting-TO-zzz-AI-Fraud-Service"
        } ]
      }
    },
    "zzz-AI-Reporting" : {
      "Type" : "Job:EmbeddedScript",
      "Script" : "#!/usr/bin/python\\n \\nfrom google import genai\\nimport os\\nimport sys\\n\\n# Initialize the client\\n# Make sure the GOOGLE_AI_KEY environment variable is set\\nclient = genai.Client(api_key=os.getenv(\"GOOGLE_AI_KEY\"))\\n \\n# Upload the file\\nprint(f\"Uploading file...\")\\ntry:\\n    uploaded_file = client.files.upload(file=\"/opt/ctmagent/rja-transaction/rja-transaction-normilisation_part00000.csv\")\\nexcept Exception as e:\\n    print(f\"Error uploading file: {e}\")\\n    exit()\\n \\nprint(\"File uploaded successfully.\")\\n \\n# Prompt for reporting\\nprompt = os.getenv('ctmprompt')\\n\\n# Generate content\\nprint(\"Generating Sentiment Scores...\")\\ntry:\\n    response = client.models.generate_content(\\n        model=\"gemini-2.5-pro\",\\n        contents=[prompt, uploaded_file]\\n    )\\nexcept Exception as e:\\n    print(f\"Error generating content: {e}\")\\n    # Try to clean up the uploaded file if an error occurs\\n    client.files.delete(name=uploaded_file.name)\\n    exit()\\n \\nprint(response.text)\\n \\n# Clean up the uploaded file\\nprint(f\"Deleting temporary uploaded file {uploaded_file.name}...\")\\nclient.files.delete(name=uploaded_file.name)\\nprint(\"Cleanup complete.\")",

      "FileName" : "reporting.py",
      "Host" : "ctmawsdemoqa-mft1.vse.bmc.com",
     
      "RunAs" : "controlm",

      "Variables" : [ {
        "ctmprompt" : "list all Gift Card transactions"
      } ],
      "When" : {
        "WeekDays" : [ "NONE" ],
        "MonthDays" : [ "ALL" ],
        "DaysRelation" : "OR"
      },
      "IfBase:Folder:CompletionStatus_1" : {
        "Type" : "If:CompletionStatus",
        "CompletionStatus" : "OK",
        "Mail_0" : {
          "Type" : "Action:Mail",
          "Subject" : "Fraud detection report",
          "To" : "regardt_jacobs@bmc.com",
          "AttachOutput" : true
        }
      },
      "IfBase:Folder:CompletionStatus_2" : {
        "Type" : "If:CompletionStatus",
        "CompletionStatus" : "OK",
        "Output_0" : {
          "Type" : "Action:Output",
          "Destination" : "Report.txt"
        }
      },
      "eventsToWaitFor" : {
        "Type" : "WaitForEvents",
        "Events" : [ {
          "Event" : "zzz-transfer-normilised-file-TO-zzz-AI-Reporting"
        } ]
      },
      "eventsToAdd" : {
        "Type" : "AddEvents",
        "Events" : [ {
          "Event" : "zzz-AI-Reporting-TO-zzz-AI-Fraud-Service"
        } ]
      },
      "eventsToDelete" : {
        "Type" : "DeleteEvents",
        "Events" : [ {
          "Event" : "zzz-transfer-normilised-file-TO-zzz-AI-Reporting"
        } ]
      }
    },
    "zzz-Transaction-Logs" : {
      "Type" : "Job:FileTransfer",
      "ConnectionProfileSrc" : "ODD_S3_CP",
      "ConnectionProfileDest" : "rjas3",
      "S3BucketNameSrc" : "rja-ai-bucket",
      "S3BucketNameDest" : "rja-ai-bucket",

      "Host" : "ctmawsdemoqa-mft2.vse.bmc.com",

      "RunAs" : "ODD_S3_CP+rjas3",

      "Variables" : [ {
        "FTP-LOSTYPE" : "Unix"
      }, {
        "FTP-CONNTYPE1" : "S3"
      }, {
        "FTP-ROSTYPE" : "Unix"
      }, {
        "FTP-CONNTYPE2" : "S3"
      }, {
        "FTP-CM_VER" : "9.0.00"
      }, {
        "FTP-COMPRESSION11" : "0"
      }, {
        "FTP-COMPRESSION21" : "0"
      }, {
        "FTP-OVERRIDE_WATCH_INTERVAL1" : "0"
      }, {
        "FTP-POSTCMD_ON_FAILURE1" : "0"
      }, {
        "FTP-SYNC_DIR_NO_DEL1" : "0"
      } ],
      "FileTransfers" : [ {
        "TransferType" : "Binary",
        "TransferOption" : "SrcToDest",
        "Src" : "/Incoming/transaction_logs.csv",
        "Dest" : "/Outgoing/",
        "SRC_PATTERN" : "Wildcard",
        "ABSTIME" : "0",
        "TIMELIMIT" : "0",
        "UNIQUE" : "0",
        "SRCOPT" : "0",
        "IF_EXIST" : "0",
        "DSTOPT" : "0",
        "ContinueOnFailure" : false,
        "DeleteFileOnDestIfFails" : false,
        "FailJobOnDestActionFailure" : false,
        "FailJobOnSourceCommandFailure" : false,
        "FailJobOnDestCommandFailure" : false,
        "RECURSIVE" : "0",
        "EXCLUDE_WILDCARD" : "0",
        "TRIM" : "1",
        "NULLFLDS" : "0",
        "VERNUM" : "0",
        "CASEIFS" : "0",
        "FileWatcherOptions" : {
          "MinDetectedSizeInBytes" : "0",
          "UnitsOfTimeLimit" : "Minutes",
          "SkipToNextFileIfCriteriaNotMatch" : false
        },
        "IncrementalTransfer" : {
          "IncrementalTransferEnabled" : false,
          "MaxModificationAgeForFirstRunEnabled" : false,
          "MaxModificationAgeForFirstRunInHours" : "1"
        },
        "DestinationFilename" : {
          "ModifyCase" : "No"
        },
        "SimultaneousTransfer" : {
          "TransferMultipleFilesSimultaneously" : false
        }
      } ],
      "When" : {
        "WeekDays" : [ "NONE" ],
        "MonthDays" : [ "ALL" ],
        "DaysRelation" : "OR"
      },
      "eventsToAdd" : {
        "Type" : "AddEvents",
        "Events" : [ {
          "Event" : "zzz-Transaction-Logs-TO-zzz-transaction-normilisation"
        } ]
      }
    },
    "zzz-transaction-normilisation" : {
      "Type" : "Job:AWS Glue DataBrew",
      "ConnectionProfile" : "RJADATABREW",
      "Job Name" : "rja-transaction-normilisation",
      "Output Job Logs" : "checked",
  
      "Host" : "ctmawsdemoqa.vse.bmc.com",

      "RunAs" : "RJADATABREW",
  
      "When" : {
        "WeekDays" : [ "NONE" ],
        "MonthDays" : [ "ALL" ],
        "DaysRelation" : "OR"
      },
      "eventsToWaitFor" : {
        "Type" : "WaitForEvents",
        "Events" : [ {
          "Event" : "zzz-Transaction-Logs-TO-zzz-transaction-normilisation"
        } ]
      },
      "eventsToAdd" : {
        "Type" : "AddEvents",
        "Events" : [ {
          "Event" : "zzz-transaction-normilisation-TO-zzz-transfer-normilised-file"
        } ]
      },
      "eventsToDelete" : {
        "Type" : "DeleteEvents",
        "Events" : [ {
          "Event" : "zzz-Transaction-Logs-TO-zzz-transaction-normilisation"
        } ]
      }
    },
    "zzz-transfer-normilised-file" : {
      "Type" : "Job:FileTransfer",
      "ConnectionProfileSrc" : "rjas3",
      "ConnectionProfileDest" : "ZZM_LOCAL",
      "S3BucketName" : "rja-ai-bucket",

      "Host" : "ctmawsdemoqa-mft1.vse.bmc.com",

      "RunAs" : "rjas3+ZZM_LOCAL",
 
      "Variables" : [ {
        "FTP-LOSTYPE" : "Unix"
      }, {
        "FTP-CONNTYPE1" : "S3"
      }, {
        "FTP-ROSTYPE" : "Unix"
      }, {
        "FTP-CONNTYPE2" : "File System"
      }, {
        "FTP-RHOST" : "<Agent Host>"
      }, {
        "FTP-RUSER" : "ctmagent"
      }, {
        "FTP-CM_VER" : "9.0.00"
      }, {
        "FTP-COMPRESSION11" : "0"
      }, {
        "FTP-COMPRESSION21" : "0"
      }, {
        "FTP-OVERRIDE_WATCH_INTERVAL1" : "0"
      }, {
        "FTP-POSTCMD_ON_FAILURE1" : "0"
      }, {
        "FTP-SYNC_DIR_NO_DEL1" : "0"
      } ],
      "FileTransfers" : [ {
        "TransferType" : "Binary",
        "TransferOption" : "SrcToDest",
        "Src" : "/Normilised/rja-transaction-normilisation_part00000.csv",
        "Dest" : "/opt/ctmagent/rja-transaction/",
        "SRC_PATTERN" : "Wildcard",
        "ABSTIME" : "0",
        "TIMELIMIT" : "0",
        "UNIQUE" : "0",
        "SRCOPT" : "0",
        "IF_EXIST" : "0",
        "DSTOPT" : "0",
        "ContinueOnFailure" : false,
        "DeleteFileOnDestIfFails" : false,
        "FailJobOnDestActionFailure" : false,
        "FailJobOnSourceCommandFailure" : false,
        "FailJobOnDestCommandFailure" : false,
        "RECURSIVE" : "0",
        "EXCLUDE_WILDCARD" : "0",
        "TRIM" : "1",
        "NULLFLDS" : "0",
        "VERNUM" : "0",
        "CASEIFS" : "0",
        "FileWatcherOptions" : {
          "MinDetectedSizeInBytes" : "0",
          "UnitsOfTimeLimit" : "Minutes",
          "SkipToNextFileIfCriteriaNotMatch" : false
        },
        "IncrementalTransfer" : {
          "IncrementalTransferEnabled" : false,
          "MaxModificationAgeForFirstRunEnabled" : false,
          "MaxModificationAgeForFirstRunInHours" : "1"
        },
        "SimultaneousTransfer" : {
          "TransferMultipleFilesSimultaneously" : false
        }
      } ],
      "When" : {
        "WeekDays" : [ "NONE" ],
        "MonthDays" : [ "ALL" ],
        "DaysRelation" : "OR"
      },
      "eventsToWaitFor" : {
        "Type" : "WaitForEvents",
        "Events" : [ {
          "Event" : "zzz-transaction-normilisation-TO-zzz-transfer-normilised-file"
        } ]
      },
      "eventsToAdd" : {
        "Type" : "AddEvents",
        "Events" : [ {
          "Event" : "zzz-transfer-normilised-file-TO-zzz-AI-Reporting"
        } ]
      },
      "eventsToDelete" : {
        "Type" : "DeleteEvents",
        "Events" : [ {
          "Event" : "zzz-transaction-normilisation-TO-zzz-transfer-normilised-file"
        } ]
      }
    }
  }
}
